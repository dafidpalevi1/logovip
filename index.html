<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Logo VIP Agency</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<style>
body { background: #000; margin: 0; font-family: sans-serif; }
.glow { filter: drop-shadow(0 0 8px rgba(240,216,106,0.9)); }

#captureArea {
  position: relative;
  width: 90vw;
  max-width: 420px;
  aspect-ratio:1/1;
  background:#000;
  margin:0 auto;
  overflow:hidden;
}

#profileImg {
  object-fit: cover;
  border-radius: 50%;
  border: 4px solid #f0d86a;
  position: absolute;
  cursor: grab;
  display:none;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  touch-action:none;
  max-width:65%;
  max-height:65%;
}

#agencyLogo {
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  z-index:30;
  width:45%;
  height:auto;
  object-fit:contain;
  top:-5%;
}

.controlWrapper { display:flex; flex-direction:column; gap:0.8rem; align-items:center; margin-top:2rem; width:100%; max-width:420px; }
#uploadGroup { display:flex; gap:0.5rem; }
#uploadWrapper { display:inline-block; background:#1f2937; padding:0.5rem 1rem; border-radius:0.5rem; cursor:pointer; }
#uploadWrapper:hover { background:#374151; }
#editPhotoBtn { display:inline-block; padding:0.5rem 1rem; border-radius:0.5rem; cursor:pointer; background:#1e40af; color:white; font-weight:bold; }
#editPhotoBtn:hover { background:#3b82f6; }
input[type="text"] { width:80%; padding:0.5rem; border-radius:0.5rem; border:1px solid #555; background:#1f2937; color:white; text-align:center; }

#nameBoard {
  position:absolute;
  bottom:4%;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  align-items:center;
  justify-content:center;
  background:#4b3200;
  padding:0 12px;
  border-radius:12px;
  height:32px;
  z-index:30;
}

#nameText {
  color:white;
  font-weight:800;
  font-size:1rem;
  text-align:center;
  line-height:32px;
  white-space:nowrap;
}

/* Bintang kiri kanan */
.star {
  position:absolute;
  width:20px;
  height:20px;
  fill:white;
  top:50%;
  transform:translateY(-50%);
  z-index:25;
}
#starLeft { left:5%; }
#starRight { right:5%; }
</style>
</head>
<body class="flex flex-col items-center justify-start min-h-screen pt-16 p-4 space-y-6">

<div id="captureArea">

<!-- Logo agency PNG -->
<img id="agencyLogo" src="image/vip.png" alt="Logo Agency"
     style="position:absolute; left:50%; transform:translateX(-50%); z-index:30; width:32%; height:auto; top:12%;" />


  <!-- Foto profil kreator -->
  <img id="profileImg" src="" alt="Foto Kreator"/>

  <!-- Lingkaran border -->
  <div class="absolute inset-0 flex items-center justify-center">
    <svg viewBox="0 0 320 320" class="w-[85%] h-[85%]"><!-- sedikit lebih kecil -->
      <defs>
        <linearGradient id="gold" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#d4b94f"/>
          <stop offset="100%" stop-color="#f0d86a"/>
        </linearGradient>
        <linearGradient id="black" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#111"/>
          <stop offset="100%" stop-color="#333"/>
        </linearGradient>
      </defs>
      <circle cx="160" cy="160" r="120" stroke="url(#black)" stroke-width="28" fill="none"/>
      <circle cx="160" cy="160" r="120" stroke="url(#gold)" stroke-width="20" fill="none" stroke-dasharray="170 150"/>
    </svg>
  </div>

  <!-- Bintang kiri & kanan -->
  <svg class="star" id="starLeft" viewBox="0 0 24 24">
    <polygon points="12,2 15,9 22,9 17,14 19,21 12,17 5,21 7,14 2,9 9,9"/>
  </svg>
  <svg class="star" id="starRight" viewBox="0 0 24 24">
    <polygon points="12,2 15,9 22,9 17,14 19,21 12,17 5,21 7,14 2,9 9,9"/>
  </svg>

 <!-- Papan nama -->
<div id="nameBoard" style="position:absolute; left:50%; transform:translateX(-50%); bottom:16%; display:inline-flex; align-items:center; justify-content:center; background:#4b3200; padding:0 12px; border-radius:12px; min-width:80px; max-width:90%; z-index:30;">
  <span id="nameText" style="color:white; font-weight:800; font-size:1rem; text-align:center; white-space:nowrap;">Nama Kreator</span>
</div>

</div>

<div class="controlWrapper">
  <input type="text" id="creatorName" placeholder="Username akun TikTok"/>
  
  <div id="uploadGroup">
    <label id="uploadWrapper">
      <span class="text-white select-none">Upload Gambar</span>
      <input type="file" id="uploadImg" accept="image/*" class="hidden"/>
    </label>
    <button id="editPhotoBtn">Edit Gambar</button>
  </div>

  <button id="downloadBtn" class="px-6 py-3 bg-yellow-500 text-black font-bold rounded hover:bg-yellow-400">Download</button>
</div>

<div id="cropperModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
  <div class="bg-white p-4 rounded shadow-lg max-w-md w-full relative">
    <h2 class="text-lg font-bold mb-2">Sesuaikan Foto</h2>
    <div class="w-full h-64 relative">
      <img id="cropperImage" src="" class="max-h-64 mx-auto"/>
    </div>
    <div class="flex justify-end gap-2 mt-4 relative z-50">
      <button id="cancelCrop" class="px-4 py-2 bg-gray-400 text-black rounded">Batal</button>
      <button id="saveCrop" class="px-4 py-2 bg-yellow-500 text-black font-bold rounded">Simpan</button>
    </div>
  </div>
</div>

<script>
let cropper;
let lastUploadedSrc = "";

document.getElementById("creatorName").addEventListener("input", function(){
  const textEl = document.getElementById("nameText");
  textEl.innerText = this.value || "Nama Kreator";
});

function openCropper(src){
  const cropperImage = document.getElementById("cropperImage");
  cropperImage.src = src;
  cropperImage.onload = () => {
    document.getElementById("cropperModal").classList.remove("hidden");
    if(cropper) cropper.destroy();
    cropper = new Cropper(cropperImage, {
      aspectRatio:1,
      viewMode:1,
      dragMode:"move",
      autoCropArea:1,
      responsive:true,
      background:false,
      minContainerWidth:300,
      minContainerHeight:300,
    });
  }
}

document.getElementById("uploadImg").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(ev){
      lastUploadedSrc = ev.target.result;
      openCropper(lastUploadedSrc);
    }
    reader.readAsDataURL(file);
  }
});

document.getElementById("editPhotoBtn").addEventListener("click", function(){
  if(!lastUploadedSrc){
    alert("Upload foto dulu!");
    return;
  }
  openCropper(lastUploadedSrc);
});

document.getElementById("cancelCrop").addEventListener("click", function(){
  document.getElementById("cropperModal").classList.add("hidden");
  if(cropper) cropper.destroy();
});

document.getElementById("saveCrop").addEventListener("click", function(){
  const canvasCrop = cropper.getCroppedCanvas({width:400, height:400});
  const profileImg = document.getElementById("profileImg");
  profileImg.src = canvasCrop.toDataURL();
  profileImg.style.display = "block";
  profileImg.style.top = "50%";
  profileImg.style.left = "50%";
  profileImg.style.transform = "translate(-50%, -50%)";
  document.getElementById("cropperModal").classList.add("hidden");
  cropper.destroy();
  lastUploadedSrc = profileImg.src;

  // Drag foto
  let isDragging=false, startX=0, startY=0, initX=0, initY=0;
  const profile = profileImg;
  profile.onpointerdown=function(e){
    isDragging=true;
    startX=e.clientX||e.touches[0].clientX;
    startY=e.clientY||e.touches[0].clientY;
    const style = window.getComputedStyle(profile);
    const matrix = new WebKitCSSMatrix(style.transform);
    initX=matrix.m41;
    initY=matrix.m42;
    profile.setPointerCapture(e.pointerId);
  }
  profile.onpointermove=function(e){
    if(!isDragging) return;
    let moveX = (e.clientX||e.touches[0].clientX)-startX;
    let moveY = (e.clientY||e.touches[0].clientY)-startY;
    profile.style.transform = `translate(${initX+moveX}px, ${initY+moveY}px)`;
  }
  profile.onpointerup=function(){ isDragging=false; }
  profile.ontouchend=function(){ isDragging=false; }
});

document.getElementById("downloadBtn").addEventListener("click", async function(){
  const profileImg = document.getElementById("profileImg");
  if(!profileImg.src) return alert("Upload foto dulu!");
  const captureArea=document.getElementById("captureArea");

  html2canvas(captureArea, {backgroundColor:null, scale:1, useCORS:true}).then(canvas=>{
    const finalCanvas=document.createElement("canvas");
    finalCanvas.width=644; finalCanvas.height=644;
    const ctx=finalCanvas.getContext("2d");
    ctx.drawImage(canvas,0,0,644,644);
    const link=document.createElement("a");
    link.href=finalCanvas.toDataURL("image/png");
    link.download="vip-agency.png";
    link.click();
  });
});
</script>
</body>
</html>
