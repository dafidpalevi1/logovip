<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIP Agency Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;900&family=Poppins:wght@600;700;900&family=Roboto:wght@600;700;900&display=swap" rel="stylesheet">
<style>
body {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: #000;
  min-height: 100vh;
  margin: 0;
  padding: 20px 10px;
  font-family: 'Montserrat', sans-serif;
  color: white;
}
.container {
  position: relative;
  width: 100%;
  max-width: 644px;
  aspect-ratio: 1/1;
  background: #111;
}
.container img.bg { width: 100%; height: 100%; object-fit: cover; display: block; }
#photo-wrapper {
  position: absolute;
  top: 50%; left: 50%;
  width: 45%; height: 45%;
  transform: translate(-50%,-50%);
  display: none;
  z-index:2;
}
#user-photo { width: 100%; height:100%; object-fit: cover; cursor: move; border: 2px dashed rgba(255,255,255,0.4); touch-action: none; }
.resize-handle {
  position: absolute;
  width:14px; height:14px;
  background: gold;
  border:2px solid black;
  border-radius:50%;
  z-index:5;
  touch-action:none;
}
.resize-handle.br { bottom:-8px; right:-8px; cursor: se-resize;}
.resize-handle.bl { bottom:-8px; left:-8px; cursor: sw-resize;}
.resize-handle.tr { top:-8px; right:-8px; cursor: ne-resize;}
.resize-handle.tl { top:-8px; left:-8px; cursor: nw-resize;}
.resize-handle.ml { top:50%; left:-8px; transform:translateY(-50%); cursor:w-resize;}
.resize-handle.mr { top:50%; right:-8px; transform:translateY(-50%); cursor:e-resize;}
.resize-handle.mt { top:-8px; left:50%; transform:translateX(-50%); cursor:n-resize;}
.resize-handle.mb { bottom:-8px; left:50%; transform:translateX(-50%); cursor:s-resize;}
#overlay { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; pointer-events:none; z-index:3; }
#papan-nama {
  position:absolute; bottom:16%; left:50%; transform:translateX(-50%);
  color:#fff; font-size:30px; font-weight:900; text-align:center;
  width:80%; font-family:'Montserrat',sans-serif;
  text-shadow: -2px -2px 4px rgba(0,0,0,0.8),
                2px -2px 4px rgba(0,0,0,0.8),
               -2px 2px 4px rgba(0,0,0,0.8),
                2px 2px 4px rgba(0,0,0,0.8);
  z-index:4;
}
.controls {
  margin-top:20px;
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:center;
  width:100%;
  max-width:420px;
}
input[type="text"], button, label, select, input[type="range"] {
  padding:10px 14px;
  border-radius:6px;
  border:none;
  font-size:16px;
  font-family:'Montserrat',sans-serif;
  width:100%;
  box-sizing:border-box;
}
button,label { cursor:pointer; background: gold; color:black; font-weight:700; text-align:center; }
#upload-photo { display:none; }
.btn-row { display:flex; flex-wrap:wrap; gap:10px; width:100%; }
.btn-row > * { flex:1; min-width:120px; }
.font-controls,.size-controls { display:flex; gap:10px; width:100%; }
.font-controls > *, .size-controls > * { flex:1; }
#size-slider { display:none; margin-top:5px; }
</style>
</head>
<body>
<div class="container" id="capture-area">
  <img class="bg" src="image/logoku.jpeg" alt="VIP Agency Background">
  <div id="photo-wrapper">
    <img id="user-photo" src="" alt="">
    <div class="resize-handle tl"></div>
    <div class="resize-handle tr"></div>
    <div class="resize-handle bl"></div>
    <div class="resize-handle br"></div>
    <div class="resize-handle ml"></div>
    <div class="resize-handle mr"></div>
    <div class="resize-handle mt"></div>
    <div class="resize-handle mb"></div>
  </div>
  <img id="overlay" src="image/lapisan.png" alt="Overlay">
  <div id="papan-nama">Tulis Nama</div>
</div>

<div class="controls">
  <input type="text" id="nama-input" placeholder="Masukkan nama">

  <div class="font-controls">
    <select id="font-select">
      <option value="Montserrat">Montserrat</option>
      <option value="Poppins">Poppins</option>
      <option value="Roboto">Roboto</option>
    </select>
    <input type="color" id="font-color" value="#ffffff">
  </div>

  <div class="size-controls">
    <label id="size-label" style="flex:0 0 auto;color:white;">Ukuran</label>
  </div>
  <input type="range" id="size-slider" min="12" max="80" value="30">

  <div class="btn-row">
    <label for="upload-photo">Upload Gambar</label>
    <input type="file" id="upload-photo" accept="image/*">
    <button id="remove-bg-btn">Remove Background</button>
    <button id="download-btn">Download</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
const namaInput = document.getElementById("nama-input");
const papanNama = document.getElementById("papan-nama");
const uploadPhoto = document.getElementById("upload-photo");
const userPhoto = document.getElementById("user-photo");
const photoWrapper = document.getElementById("photo-wrapper");
const downloadBtn = document.getElementById("download-btn");
const captureArea = document.getElementById("capture-area");
const fontSelect = document.getElementById("font-select");
const fontColor = document.getElementById("font-color");
const sizeLabel = document.getElementById("size-label");
const sizeSlider = document.getElementById("size-slider");
const removeBgBtn = document.getElementById("remove-bg-btn");

// Update nama
namaInput.addEventListener("input", () => { papanNama.textContent = namaInput.value; });

// Ganti font
fontSelect.addEventListener("change", () => { papanNama.style.fontFamily = fontSelect.value + ", sans-serif"; });

// Ganti warna font
fontColor.addEventListener("input", () => { papanNama.style.color = fontColor.value; });

// Toggle slider muncul
sizeLabel.addEventListener("click", () => {
  sizeSlider.style.display = sizeSlider.style.display === "block" ? "none" : "block";
});

// Ganti ukuran font
sizeSlider.addEventListener("input", () => { papanNama.style.fontSize = sizeSlider.value + "px"; });

// Upload foto
uploadPhoto.addEventListener("change", (e)=>{
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(evt){
      userPhoto.src = evt.target.result;
      photoWrapper.style.display = "block";
    };
    reader.readAsDataURL(file);
  }
});

// Remove Background
removeBgBtn.addEventListener("click", async ()=>{
  if(!userPhoto.src) return alert("Upload gambar dulu!");
  removeBgBtn.textContent = "Processing...";
  
  try {
    const file = dataURLtoFile(userPhoto.src,"userphoto.png");
    const formData = new FormData();
    formData.append("image_file", file);
    formData.append("size", "auto");

    const response = await fetch("https://api.remove.bg/v1.0/removebg", {
      method: "POST",
      headers: {
        "X-Api-Key": "iiqMWGJGBZr4BDCdxiucuzPw"
      },
      body: formData
    });

    if(!response.ok) throw new Error("Gagal remove background");

    const blob = await response.blob();
    const url = URL.createObjectURL(blob);
    userPhoto.src = url;
    photoWrapper.style.display = "block";
  } catch(err) {
    alert("Error: " + err.message);
  } finally {
    removeBgBtn.textContent = "Remove Background";
  }
});

// Helper: dataURL -> File
function dataURLtoFile(dataurl, filename) {
  let arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
  bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
  while(n--){ u8arr[n] = bstr.charCodeAt(n); }
  return new File([u8arr], filename, {type:mime});
}

// Drag & Resize
let isDragging=false,dragX,dragY;
function startDrag(x,y){isDragging=true; dragX=x-photoWrapper.offsetLeft; dragY=y-photoWrapper.offsetTop;}
function doDrag(x,y){if(isDragging){photoWrapper.style.left=(x-dragX)+"px"; photoWrapper.style.top=(y-dragY)+"px";}}
function endDrag(){isDragging=false;}
photoWrapper.addEventListener("mousedown",(e)=>{if(!e.target.classList.contains("resize-handle")) startDrag(e.clientX,e.clientY);});
document.addEventListener("mousemove",(e)=>doDrag(e.clientX,e.clientY));
document.addEventListener("mouseup",endDrag);
photoWrapper.addEventListener("touchstart",(e)=>{if(!e.target.classList.contains("resize-handle")){const t=e.touches[0]; startDrag(t.clientX,t.clientY);}});
document.addEventListener("touchmove",(e)=>{if(isDragging){const t=e.touches[0]; doDrag(t.clientX,t.clientY);}});
document.addEventListener("touchend",endDrag);

// Resize handles
const handles = document.querySelectorAll(".resize-handle");
let isResizing=false,currentHandle,startX,startY,startWidth,startHeight,startLeft,startTop,aspectRatio;
function startResize(x,y,handle){isResizing=true; currentHandle=handle; startX=x; startY=y; startWidth=photoWrapper.offsetWidth; startHeight=photoWrapper.offsetHeight; startLeft=photoWrapper.offsetLeft; startTop=photoWrapper.offsetTop; aspectRatio=startWidth/startHeight;}
function doResize(x,y){if(!isResizing)return; let dx=x-startX,dy=y-startY; 
if(currentHandle.classList.contains("br")){let w=startWidth+dx,h=w/aspectRatio; photoWrapper.style.width=w+"px"; photoWrapper.style.height=h+"px";}
else if(currentHandle.classList.contains("bl")){let w=startWidth-dx,h=w/aspectRatio; photoWrapper.style.width=w+"px"; photoWrapper.style.height=h+"px"; photoWrapper.style.left=startLeft+dx+"px";}
else if(currentHandle.classList.contains("tr")){let w=startWidth+dx,h=w/aspectRatio; photoWrapper.style.width=w+"px"; photoWrapper.style.height=h+"px"; photoWrapper.style.top=startTop+(startHeight-h)+"px";}
else if(currentHandle.classList.contains("tl")){let w=startWidth-dx,h=w/aspectRatio; photoWrapper.style.width=w+"px"; photoWrapper.style.height=h+"px"; photoWrapper.style.left=startLeft+dx+"px"; photoWrapper.style.top=startTop+(startHeight-h)+"px";}
else if(currentHandle.classList.contains("ml")){photoWrapper.style.width=startWidth-dx+"px"; photoWrapper.style.left=startLeft+dx+"px";}
else if(currentHandle.classList.contains("mr")){photoWrapper.style.width=startWidth+dx+"px";}
else if(currentHandle.classList.contains("mt")){photoWrapper.style.height=startHeight-dy+"px"; photoWrapper.style.top=startTop+dy+"px";}
else if(currentHandle.classList.contains("mb")){photoWrapper.style.height=startHeight+dy+"px";}}
function endResize(){isResizing=false;}
handles.forEach(h=>{
  h.addEventListener("mousedown",e=>{startResize(e.clientX,e.clientY,e.target); e.stopPropagation();});
  h.addEventListener("touchstart",e=>{const t=e.touches[0]; startResize(t.clientX,t.clientY,e.target); e.stopPropagation();});
});
document.addEventListener("mousemove",e=>doResize(e.clientX,e.clientY));
document.addEventListener("mouseup",endResize);
document.addEventListener("touchmove",e=>{const t=e.touches[0]; doResize(t.clientX,t.clientY);});
document.addEventListener("touchend",endResize);

// Auto hide resize
document.addEventListener("click",()=>{userPhoto.style.border="none"; handles.forEach(h=>h.style.display="none");});
photoWrapper.addEventListener("click",(e)=>{userPhoto.style.border="2px dashed rgba(255,255,255,0.4)"; handles.forEach(h=>h.style.display="block"); e.stopPropagation();});

// Download
downloadBtn.addEventListener("click",()=>{
  const oldBorder=userPhoto.style.border;
  userPhoto.style.border="none"; handles.forEach(h=>h.style.display="none");
  html2canvas(captureArea).then(canvas=>{
    const link=document.createElement("a");
    link.download="vip-agency.png";
    link.href=canvas.toDataURL("image/png");
    link.click();
    userPhoto.style.border=oldBorder; handles.forEach(h=>h.style.display="block");
  });
});
</script>
</body>
</html>
